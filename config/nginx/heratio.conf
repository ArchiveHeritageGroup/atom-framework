#
# Heratio (AtoM AHG Framework) â€” Dual-Stack Nginx Configuration
# =============================================================
# Include this file in your nginx server block to enable the
# Laravel-based Heratio entry point for specific routes.
#
# Usage in your nginx config:
#   include /path/to/atom-framework/config/nginx/heratio.conf;
#
# Place this BEFORE the main PHP handler and catch-all location blocks,
# but AFTER the extensions.conf include.
#
# All routes not matched here continue through Symfony (index.php).
#

# ======================================
# API V3 ENDPOINTS (Laravel/Heratio)
# ======================================

# Health check and framework info
location ~ ^/api/v3/ {
    try_files $uri /heratio.php$is_args$args;

    location ~ \.php$ {
        include fastcgi_params;
        fastcgi_pass unix:/run/php/php8.3-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $document_root/heratio.php;
        fastcgi_param SCRIPT_NAME /heratio.php;
    }
}

# ======================================
# FUTURE: Admin dashboard via Laravel
# Uncomment when WP2 controllers are ready
# ======================================

# location ~ ^/admin/dashboard {
#     try_files $uri /heratio.php$is_args$args;
#
#     location ~ \.php$ {
#         include fastcgi_params;
#         fastcgi_pass unix:/run/php/php8.3-fpm.sock;
#         fastcgi_param SCRIPT_FILENAME $document_root/heratio.php;
#         fastcgi_param SCRIPT_NAME /heratio.php;
#     }
# }

# ======================================
# FUTURE: Plugin-specific Laravel routes
# Add as plugins migrate from Symfony
# ======================================

# location ~ ^/donor/ {
#     try_files $uri /heratio.php$is_args$args;
#
#     location ~ \.php$ {
#         include fastcgi_params;
#         fastcgi_pass unix:/run/php/php8.3-fpm.sock;
#         fastcgi_param SCRIPT_FILENAME $document_root/heratio.php;
#         fastcgi_param SCRIPT_NAME /heratio.php;
#     }
# }
